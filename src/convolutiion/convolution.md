# 使用CUDA实现卷积加速

## 卷积实现原理

卷积输入：kernel(卷积核)，输入矩阵（M）
输出：结果矩阵

```cpp
kernel x00 x01 x02        m00 m01 m02 m03 m04    r00 r01 r02 r03 r04
       x10 x11 x12        m10 m11 m12 m13 m14    r10 r11 r12 r13 r14
       x20 x21 x22        m20 m21 m22 m23 m24    r20 r21 r22 r23 r24
                          m30 m31 m32 m33 m34    r30 r31 r32 r33 r34
                          m40 m41 m42 m43 m44    r40 r41 r42 r43 r44

r11 = m00*x00 + m01*x01 + x02*m02 + x10 * m10 +x11*m11 + x12*m12 + x20*m20 +x21*m21 + x22*m22
```

对于一种特殊情况，sobel边缘检测算子，Sobel 算子利用两个 3×3 卷积核：

Gx：检测水平方向的灰度变化（垂直边）

Gy：检测垂直方向的灰度变化（水平边）

卷积核如下（经典版本）：

```cpp
Gx 1 0 -1    Gy  1  2  1
   2 0 -2        0  0  0
   1 0 -1       -1 -2 -1
Gx_r11 = m00 + 2*m10 + m20 - m02 - 2*m12 -m22
Gy_r11 = m00 + 2*m01 + m02 - m20 - 2*m21 -m22
r11 = (Gx + Gy)/2    // 方便起见，这里使用求平均
```

## GPU加速实现

将每个线程对应输入输出矩阵每个元素输出，这样每个元素的计算过程，就可以直接并行化处理。
